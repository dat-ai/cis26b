/*
/*
CIS 22C - Winter 2016
------------------------------------------------------------------
HOMEWORK 5 - Huffman Tree - Heap, HashedTable
------------------------------------------------------------------
Author:			 Dat Thanh Nguyen
IDE:			 Microsoft Visual Studio 2015
Debugging Tools: Native Memory Diagnostic Tools + Visual Leak Detector

Last Update: 8:35 PM 2/21/2016
------------------------------------------------------------------

9:30 PM 3/9/2016
*/

#include<iostream>
#include <iomanip>
#include <fstream>
#include "HuffmanTree.h"
#include "HashTable.h"
#include "MinHeap.h"
#include <bitset>
#include <algorithm>
#define filename ""
#define ANSCII_SIZE 200 // This is the maxinum possibility for ANSCII Table. Not sure how the ANSCII in different language would be, though!
using namespace std;
int readFile(HashTable&, vector<HuffmanNode*>&, string&);
void printEncodedText(HashTable&,string,string&);
int main() {

	//This hashtable would allow insert and search in O(1) instead of O(n)
	//ANSCII hashtable
	HashTable ht(ANSCII_SIZE); 
	//Instead of an array, I decided to use vector.
	vector<HuffmanNode*> t;
	string uncompressedbits, compressedbits, decodedtext;
	int size = readFile(ht,t,uncompressedbits);
	//Build a min_heap
	MinHeap heap(t);
	//Build the Huffman Tree from previous heap
	HuffmanTree huffmanTree(heap);
	huffmanTree.encode(); 
	ht.displayTable();
	printEncodedText(ht,uncompressedbits,compressedbits);
	//Decode binary into text
	huffmanTree.decode(compressedbits, decodedtext);
	//Print out decoded text
	cout << "\n********************************Decoded Text using HuffmanTree & Encoded Text*****************************\n";
	cout << decodedtext << endl;	
//Release memory
	huffmanTree.destroyTree();

	cout << "\nPlease press enter to quit...";
	cin.get();
	return 0; 
}
int readFile(HashTable& ht, vector<HuffmanNode*>&t, string& s) {

	ifstream input;
	input.open("sources.txt");
	int size = 0;
	if (input.is_open()) {
		char c;
		while (input.get(c)) {
		//	cout << c;
			s += bitset<8>(c).to_string();
			HuffmanNode newchar(c);
			ht.insert(&newchar);
		}
		size = ht.getOccupiedSize();
		ht.initialize(t);
		input.close();
	}
	else cout << "Error reading file!" << endl;
	
	return size;
}
void printEncodedText(HashTable& ht, string s, string& compressedbits) {
	ifstream input;
	input.open("sources.txt");
	int size = 0;
	if (input.is_open()) {
		cout << "\n\n ********************************Uncompressed Text Representation in Binary*****************************************\n";
		cout << s << endl;
		cout << "\n\n ********************************Encoded Text using Hash Table & Huffman Tree in Binary***************************** \n";
		char c;
		while (input.get(c)) {
			//	cout << c;
			string bitstring = ht.searchBits(c);
			compressedbits += bitstring;
			cout << bitstring;
		}
		cout << endl;
		input.close();
	}
	else cout << "Error reading file!" << endl;
}

/*
Sample Output:
--------------------------------------------
Char|Frequency | Orginal Bits| Huffman Bits|
--------------------------------------------
   |    155   | 00100000    | 101         |
,  |    11    | 00101100    | 1110011     |
-  |    2     | 00101101    | 1110111101  |
.  |    8     | 00101110    | 0110010     |
B  |    1     | 01000010    | 1110010010  |
D  |    4     | 01000100    | 01100111    |
F  |    1     | 01000110    | 1110010101  |
I  |    2     | 01001001    | 111001000   |
S  |    1     | 01010011    | 1110010011  |
U  |    1     | 01010101    | 1110010100  |
a  |    92    | 01100001    | 1111        |
b  |    5     | 01100010    | 11101100    |
c  |    34    | 01100011    | 10011       |
d  |    30    | 01100100    | 01101       |
e  |    104   | 01100101    | 001         |
f  |    29    | 01100110    | 01010       |
g  |    25    | 01100111    | 01000       |
h  |    20    | 01101000    | 111000      |
i  |    63    | 01101001    | 0111        |
k  |    6     | 01101011    | 11101110    |
l  |    29    | 01101100    | 01011       |
m  |    28    | 01101101    | 01001       |
n  |    52    | 01101110    | 0001        |
o  |    50    | 01101111    | 0000        |
p  |    22    | 01110000    | 111010      |
q  |    1     | 01110001    | 1110111100  |
r  |    66    | 01110010    | 1000        |
s  |    73    | 01110011    | 1100        |
t  |    84    | 01110100    | 1101        |
u  |    34    | 01110101    | 10010       |
v  |    3     | 01110110    | 111011111   |
w  |    6     | 01110111    | 11101101    |
x  |    3     | 01111000    | 111001011   |
y  |    14    | 01111001    | 011000      |
z  |    4     | 01111010    | 01100110    |
--------------------------------------------
Total size:    | 8504 Bits   | 4553 Bits   |
Saved 46.4605% Memory!
--------------------------------------------


********************************Uncompressed Text Representation in Binary*****************************************
01001001011011100010000001100011011011110110110101110000011101010111010001100101011100100010000001110011011000110110100101100101011011100110001101100101001011000010000001100001001000000110010001100001011101000110000100100000011100110111010001110010011101010110001101110100011101010111001001100101001000000110100101110011001000000110000100100000011100000110000101110010011101000110100101100011011101010110110001100001011100100010000001110111011000010111100100100000011011110110011000100000011100110111010001101111011100100110100101101110011001110010000001100001011011100110010000100000011011110111001001100111011000010110111001101001011110100110100101101110011001110010000001100100011000010111010001100001001000000110100101101110001000000110000100100000011000110110111101101101011100000111010101110100011001010111001000100000011100110110111100100000011101000110100001100001011101000010000001101001011101000010000001100011011000010110111000100000011000100110010100100000011101010111001101100101011001000010000001100101011001100110011001101001011000110110100101100101011011100111010001101100011110010010111000100000010001000110100101100110011001100110010101110010011001010110111001110100001000000110101101101001011011100110010001110011001000000110111101100110001000000110010001100001011101000110000100100000011100110111010001110010011101010110001101110100011101010111001001100101011100110010000001100001011100100110010100100000011100110111010101101001011101000110010101100100001000000111010001101111001000000110010001101001011001100110011001100101011100100110010101101110011101000010000001101011011010010110111001100100011100110010000001101111011001100010000001100001011100000111000001101100011010010110001101100001011101000110100101101111011011100111001100101100001000000110000101101110011001000010000001110011011011110110110101100101001000000110000101110010011001010010000001101000011010010110011101101000011011000111100100100000011100110111000001100101011000110110100101100001011011000110100101111010011001010110010000100000011101000110111100100000011100110111000001100101011000110110100101100110011010010110001100100000011101000110000101110011011010110111001100101110001000000100011001101111011100100010000001100101011110000110000101101101011100000110110001100101001011000010000001000010001011010111010001110010011001010110010101110011001000000110000101110010011001010010000001110000011000010111001001110100011010010110001101110101011011000110000101110010011011000111100100100000011101110110010101101100011011000010110101110011011101010110100101110100011001010110010000100000011001100110111101110010001000000110100101101101011100000110110001100101011011010110010101101110011101000110000101110100011010010110111101101110001000000110111101100110001000000110010001100001011101000110000101100010011000010111001101100101011100110010110000100000011101110110100001101001011011000110010100100000011000110110111101101101011100000110100101101100011001010111001000100000011010010110110101110000011011000110010101101101011001010110111001110100011000010111010001101001011011110110111001110011001000000111010101110011011101010110000101101100011011000111100100100000011101010111001101100101001000000110100001100001011100110110100000100000011101000110000101100010011011000110010101110011001000000111010001101111001000000110110001101111011011110110101100100000011101010111000000100000011010010110010001100101011011100111010001101001011001100110100101100101011100100111001100101110001000000100010001100001011101000110000100100000011100110111010001110010011101010110001101110100011101010111001001100101011100110010000001100001011100100110010100100000011101010111001101100101011001000010000001101001011011100010000001100001011011000110110101101111011100110111010000100000011001010111011001100101011100100111100100100000011100000111001001101111011001110111001001100001011011010010000001101111011100100010000001110011011011110110011001110100011101110110000101110010011001010010000001110011011110010111001101110100011001010110110100101110001000000100010001100001011101000110000100100000011100110111010001110010011101010110001101110100011101010111001001100101011100110010000001110000011100100110111101110110011010010110010001100101001000000110000100100000011011010110010101100001011011100111001100100000011101000110111100100000011011010110000101101110011000010110011101100101001000000110100001110101011001110110010100100000011000010110110101101111011101010110111001110100011100110010000001101111011001100010000001100100011000010111010001100001001000000110010101100110011001100110100101100011011010010110010101101110011101000110110001111001001011000010000001110011011101010110001101101000001000000110000101110011001000000110110001100001011100100110011101100101001000000110010001100001011101000110000101100010011000010111001101100101011100110010000001100001011011100110010000100000010010010110111001110100011001010111001001101110011001010111010000100000011010010110111001100100011001010111100001101001011011100110011100100000011100110110010101110010011101100110100101100011011001010111001100101110001000000101010101110011011101010110000101101100011011000111100100101100001000000110010101100110011001100110100101100011011010010110010101101110011101000010000001100100011000010111010001100001001000000111001101110100011100100111010101100011011101000111010101110010011001010111001100100000011000010111001001100101001000000110000100100000011010110110010101111001001000000111010001101111001000000110010001100101011100110110100101100111011011100110100101101110011001110010000001100101011001100110011001101001011000110110100101100101011011100111010000100000011000010110110001100111011011110111001001101001011101000110100001101101011100110010111000100000010100110110111101101101011001010010000001100110011011110111001001101101011000010110110000100000011001000110010101110011011010010110011101101110001000000110110101100101011101000110100001101111011001000111001100100000011000010110111001100100001000000111000001110010011011110110011101110010011000010110110101101101011010010110111001100111001000000110110001100001011011100110011101110101011000010110011101100101011100110010000001100101011011010111000001101000011000010111001101101001011110100110010100100000011001000110000101110100011000010010000001110011011101000111001001110101011000110111010001110101011100100110010101110011001011000010000001110010011000010111010001101000011001010111001000100000011101000110100001100001011011100010000001100001011011000110011101101111011100100110100101110100011010000110110101110011001011000010000001100001011100110010000001110100011010000110010100100000011010110110010101111001001000000110111101110010011001110110000101101110011010010111101001101001011011100110011100100000011001100110000101100011011101000110111101110010001000000110100101101110001000000111001101101111011001100111010001110111011000010111001001100101001000000110010001100101011100110110100101100111011011100010111000100000010001000110000101110100011000010010000001110011011101000111001001110101011000110111010001110101011100100110010101110011001000000110000101110010011001010010000001101001011011010111000001101111011100100111010001100001011011100111010000100000011000100110010101100011011000010111010101110011011001010010000001110100011010000110010100100000011101110110000101111001001000000111010001101000011001010010000001110000011100100110111101100111011100100110000101101101011011010110010101110010001000000110001101101000011011110110111101110011011001010111001100100000011101000110111100100000011100100110010101110000011100100110010101110011011001010110111001110100001000000110010001100001011101000110000100100000011100110110100101100111011011100110100101100110011010010110001101100001011011100111010001101100011110010010000001100001011001100110011001100101011000110111010001110011001000000111010001101000011001010010000001100011011011000110000101110010011010010111010001111001001011000010000001100011011011110110111001100011011010010111001101100101011011100110010101110011011100110010110000100000011100110111000001100101011001010110010000100000011011110110011000100000011001010111100001100101011000110111010101110100011010010110111101101110001011000010000001100001011011100110010000100000011100110111010001101111011100100110000101100111011001010010000001110010011001010111000101110101011010010111001001100101011011010110010101101110011101000111001100100000011011110110011000100000011101000110100001100101001000000111000001110010011011110110011101110010011000010110110100101110


********************************Encoded Text using Hash Table & Huffman Tree in Binary*****************************
11100100000011011001100000100111101010010110100110001011100100110111001000110011001111001110111111010110111111101111110111001101100010010100111101100101000001101011111001011111101111010111110001101011110011100100101111111000101111011011111011000101000001010101110011010000100001110001010001011111000101101101000010000100011110001011101100110011100010100010101101111111011111101011100011011111101100110000010011110101001011010011000101110000001011101111000111111011010111110110110011111100011011110110000110110010110000101101101001010100101001111001101110010001110101011011000011001010101100111011101010010100011000001000111011011110111001110001011011100101000001010101011011111110111111011100110110001001010011110110010100000111001011111100000110111001001001111101001011011011101000010101101011101010010100011000001000111011011110111001110001011011100101000001010101111111101011101001011011110011111111010111000000011100111001110111110001011011011100000001001001101111110000011011110000111010001110000101101100010111001110100011001101111111010110111011001100010110110111010000101110011101000110011011101010011110011101110111111100111011101100011001010111100101010000100010100111100101111110100111101001011001111001110111100100101110111101110110000010011100101111110000011011110101111100011010111100111001001011111110000101101100010111101101001010110101111101111011100100100111110100101101101010100000100010101110100111101001011001010010010001110111111101011100000001101000001010101011011111110111111110110011111100001110011100111011110110111100001110101100110110011000001001111010011101011001100010101110100111101001011001010010010001110111111101011100000001110010110010110010010111101011010110110001011001011000011011110001111110011100010111011111111011000101100111001011101000010101011000000001110111010110010111010101011101101001000111010111010100111001100011000110010101011001111111110111111011100110110001001010011110110010100000111001011111100000110110010110000101101101011100011011111010110100100001100110110100111101111100110000110001011110101000000001000100011110100110100001000101110000000101011011110110111111000001101110001100011001101001010010110010101011001111111110111111011100110110001001010011110110010100000111001011110101000000011101111101110110100110111111010100100111110001110010111010000101010011111000111110100000110111100010010010000011011111010010000100100001110111001010000010101010110111111101111110100101010010100111100110111001000111010101101100011100111011100100101001111100010111111100101010111111100001000001101011011111110111111110110011111100001110010111110001011011011110010000001110100110000001001110110101110001011010011110010110111000101000101110000110001110111110111100110011100011001010111100101001100100101111010110101101100011100111010010101001010011110011011100100011101101011011111110111111011100110110001001010011110110010100000111001011111100000110111111011110111000101100010111010000101011010011100011101000000101110001010001010010101001010011110011011100100011101101111101011010000000100001111101111000010011100011001010111100100110000010010011010101000001000010011111010111010110100111000111010000001101010010011101111000000001101110010111110001011011011110101000000001000100011110100101001011100010100010101011111100010100010010111101000001110010100101001111010111000111111000111011001100011010110111111101111110111001101100010010100111101100101000001110011100111011000111111011110000011000101110111100011110001101111101011010000000100001111101111000010011100111001110111111100101110111100000110111101110001011000101000010000100011110001011101100110011100010100010101010111110011110100001000101011100011011100000001010110111101101111110000011010110100111000111010000001011001010101100111111111011111101110011011000100101001111011001010000011100101111110000011010111010011110100000100011011111000111011011110110000110011111110010110000110111011110000011011110110111110110001011101111000001101111010100000000100010001111010010100100110001011001111100000000000110000111001011101000010110000011110101000001110000100011101101011011111110111111011100011101000000101110101001111001111110001110101011011000101111101010010100011001111011100101110111100000110110011010111111100001111101011000111001110110011000000011001101111100001000100111001100111001110111001110100010010110110100000101010100111100101100110011100101101011100000001111001110111110001011011011100110100001000111101000001101100000111101111001001001111000001010010010001110111001010000010101011101111000001101111010100000000100010001111010010110010

**************************Decode Text*********************************
In computer science, a data structure is a particular way of storing and organizing data in a computer so that it can be used efficiently. Different kinds of data structures are suited to different kinds of applications, and some are highly specialized to specific tasks. For example, B-trees are particularly well-suited for implementation of databases, while compiler implementations usually use hash tables to look up identifiers. Data structures are used in almost every program or software system. Data structures provide a means to manage huge amounts of data efficiently, such as large databases and Internet indexing services. Usually, efficient data structures are a key to designing efficient algorithms. Some formal design methods and programming languages emphasize data structures, rather than algorithms, as the key organizing factor in software design. Data structures are important because the way the programmer chooses to represent data significantly affects the clarity, conciseness, speed of execution, and storage requirements of the program.



*/